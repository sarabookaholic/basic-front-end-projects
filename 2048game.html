<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2048 Game</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #faf8ef;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 40px 20px;
  }

  h1 {
    margin-bottom: 10px;
    color: #776e65;
  }

  #score-container {
    margin-bottom: 20px;
    font-size: 24px;
    font-weight: bold;
    color: #776e65;
  }

  #game-container {
    background: #bbada0;
    border-radius: 10px;
    padding: 15px;
    width: 460px;
    height: 460px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-gap: 15px;
    box-sizing: border-box;
    position: relative;
  }

  .tile {
    width: 100%;
    height: 100px;
    background: #cdc1b4;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 36px;
    color: #776e65;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }

  .tile-2 { background: #eee4da; color: #776e65; }
  .tile-4 { background: #ede0c8; color: #776e65; }
  .tile-8 { background: #f2b179; color: #f9f6f2; }
  .tile-16 { background: #f59563; color: #f9f6f2; }
  .tile-32 { background: #f67c5f; color: #f9f6f2; }
  .tile-64 { background: #f65e3b; color: #f9f6f2; }
  .tile-128 { background: #edcf72; color: #f9f6f2; font-size: 28px; }
  .tile-256 { background: #edcc61; color: #f9f6f2; font-size: 28px; }
  .tile-512 { background: #edc850; color: #f9f6f2; font-size: 28px; }
  .tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 24px; }
  .tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 24px; }

  #message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(238, 228, 218, 0.9);
    padding: 40px;
    border-radius: 10px;
    text-align: center;
    font-size: 36px;
    color: #776e65;
    display: none;
    z-index: 10;
  }

  #restart-btn {
    margin-top: 20px;
    padding: 12px 25px;
    font-size: 18px;
    background-color: #8f7a66;
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }

  #restart-btn:hover {
    background-color: #6b5e4b;
  }

  @media (max-width: 500px) {
    #game-container {
      width: 320px;
      height: 320px;
      grid-gap: 10px;
    }
    .tile {
      height: 70px;
      font-size: 24px;
    }
  }
</style>
</head>
<body>

<h1>2048 Game</h1>
<div id="score-container">Score: <span id="score">0</span></div>
<div id="game-container"></div>
<div id="message"></div>
<button id="restart-btn">Restart</button>

<script>
  const gameContainer = document.getElementById('game-container');
  const scoreEl = document.getElementById('score');
  const messageEl = document.getElementById('message');
  const restartBtn = document.getElementById('restart-btn');

  const SIZE = 4;
  let grid = [];
  let score = 0;

  // Initialize the grid with zeros
  function initGrid() {
    grid = [];
    for (let i = 0; i < SIZE; i++) {
      grid.push(new Array(SIZE).fill(0));
    }
  }

  // Add a new tile (2 or 4) to a random empty spot
  function addRandomTile() {
    const emptyCells = [];
    for (let r = 0; r < SIZE; r++) {
      for (let c = 0; c < SIZE; c++) {
        if (grid[r][c] === 0) emptyCells.push([r, c]);
      }
    }
    if (emptyCells.length === 0) return;

    const [row, col] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
    grid[row][col] = Math.random() < 0.9 ? 2 : 4;
  }

  // Render the grid to the DOM
  function renderGrid() {
    gameContainer.innerHTML = '';
    for (let r = 0; r < SIZE; r++) {
      for (let c = 0; c < SIZE; c++) {
        const val = grid[r][c];
        const tile = document.createElement('div');
        tile.classList.add('tile');
        if (val > 0) tile.classList.add(`tile-${val}`);
        tile.textContent = val === 0 ? '' : val;
        gameContainer.appendChild(tile);
      }
    }
    scoreEl.textContent = score;
  }

  // Move and merge helper functions
  // Slide one row/column left (compress zeros)
  function slide(row) {
    let arr = row.filter(val => val !== 0);
    let missing = SIZE - arr.length;
    let zeros = Array(missing).fill(0);
    return arr.concat(zeros);
  }

  // Combine tiles of the same value, only once per pair
  function combine(row) {
    for (let i = 0; i < SIZE - 1; i++) {
      if (row[i] !== 0 && row[i] === row[i + 1]) {
        row[i] *= 2;
        score += row[i];
        row[i + 1] = 0;
      }
    }
    return row;
  }

  // Move left action for grid
  function moveLeft() {
    let changed = false;
    for (let r = 0; r < SIZE; r++) {
      let row = grid[r];
      let slid = slide(row);
      let combined = combine(slid);
      let final = slide(combined);

      if (!arraysEqual(grid[r], final)) {
        grid[r] = final;
        changed = true;
      }
    }
    return changed;
  }

  // Helper: transpose matrix
  function transpose(matrix) {
    return matrix[0].map((_, i) => matrix.map(row => row[i]));
  }

  // Helper: reverse rows
  function reverse(matrix) {
    return matrix.map(row => row.slice().reverse());
  }

  // Move right action for grid
  function moveRight() {
    grid = reverse(grid);
    let changed = moveLeft();
    grid = reverse(grid);
    return changed;
  }

  // Move up action for grid
  function moveUp() {
    grid = transpose(grid);
    let changed = moveLeft();
    grid = transpose(grid);
    return changed;
  }

  // Move down action for grid
  function moveDown() {
    grid = transpose(grid);
    grid = reverse(grid);
    let changed = moveLeft();
    grid = reverse(grid);
    grid = transpose(grid);
    return changed;
  }

  // Compare two arrays for equality
  function arraysEqual(a, b) {
    return a.length === b.length && a.every((v, i) => v === b[i]);
  }

  // Check if player can move or game over
  function canMove() {
    for (let r = 0; r < SIZE; r++) {
      for (let c = 0; c < SIZE; c++) {
        if (grid[r][c] === 0) return true;
        if (c !== SIZE -1 && grid[r][c] === grid[r][c + 1]) return true;
        if (r !== SIZE -1 && grid[r][c] === grid[r + 1][c]) return true;
      }
    }
    return false;
  }

  // Check for 2048 tile (win)
  function has2048() {
    for (let r = 0; r < SIZE; r++) {
      for (let c = 0; c < SIZE; c++) {
        if (grid[r][c] === 2048) return true;
      }
    }
    return false;
  }

  // Show message overlay
  function showMessage(text) {
    messageEl.textContent = text;
    messageEl.style.display = 'block';
  }

  // Hide message overlay
  function hideMessage() {
    messageEl.style.display = 'none';
  }

  // Handle game over or win states
  function checkGameOver() {
    if (has2048()) {
      showMessage('ðŸŽ‰ You Win! ðŸŽ‰');
      inputDisabled = true;
      return true;
    }

    if (!canMove()) {
      showMessage('Game Over!');
      inputDisabled = true;
      return true;
    }

    return false;
  }

  // Variable to disable input after game ends
  let inputDisabled = false;

  // Handle key press and move tiles
  function handleKey(e) {
    if (inputDisabled) return;

    let moved = false;
    switch (e.key) {
      case 'ArrowLeft':
        moved = moveLeft();
        break;
      case 'ArrowRight':
        moved = moveRight();
        break;
      case 'ArrowUp':
        moved = moveUp();
        break;
      case 'ArrowDown':
        moved = moveDown();
        break;
      default:
        return; // Ignore other keys
    }
    if (moved) {
      addRandomTile();
      renderGrid();
      if (checkGameOver()) {
        inputDisabled = true;
      }
    }
  }

  // Initialize game
  function initGame() {
    score = 0;
    inputDisabled = false;
    hideMessage();
    initGrid();
    addRandomTile();
    addRandomTile();
    renderGrid();
  }

  // Restart button listener
  restartBtn.addEventListener('click', initGame);
  window.addEventListener('keydown', handleKey);

  initGame();
</script>

</body>
</html>
